/**
 * BaasCMS adapter for Parse.com v. 1.0.0
 * Copyright (c) 2014 Artod gartod@gmail.com
 * MIT License
*/
(function(e,t,n,r){var i=function(){function i(e){if(!n){console.info("Requires Parse JavaScript SDK.")}}var e=function(e,n){e=e||[];e=t.isArray(e)?e:[e];var r=[];for(var i=0;i<e.length;i++){var s=e[i],o=s._serverData;o.id=s.id;r.push(o)}if(n){r=r[0]||{}}return r};var r=function(e,n,r){var r=r||{};var i=t.isString(r.select)?[r.select]:t.isArray(r.select)?r.select:false,s=t.isObject(r.where)?r.where:false,o=t.isNumber(r.limit)?r.limit:false,u=t.isNumber(r.skip)?r.skip:false,a=false;if(t.isObject(r.order)){a=[];t.each(r.order,function(e,t){a.push(e>0?t:"-"+t)});if(!a.length){a=false}}else if(t.isString(r.order)){a=[r.order]}else if(t.isArray(r.order)){a=r.order}if(n){s=s||{};s.objectId=n;delete s.id}else if(s&&s.id){s.objectId=s.id;delete s.id}i&&(e._select=i);s&&(e._where=s);o&&(e._limit=o);u&&(e._skip=u);a&&(e._order=a)};t.extend(i.prototype,{_query:function(t,i,s,o){var u=n.Object.extend(t),a=new n.Query(u);r(a,i,s);a.find().done(function(t){var n=e(t,s.first);o.resolve(n)}).fail(function(e){o.reject(e)});return o.promise()},_count:function(e,i,s){var o=n.Object.extend(e),u=new n.Query(o);r(u,"",i);u._limit=0;t.extend(u._extraOptions,{count:1});u.count().done(function(e){s.resolve(e)}).fail(function(e){s.reject(e)});return s.promise()},_save:function(t,r,i){var s=n.Object.extend(t),o=new s;o.save(r).done(function(t){var n=e(t,true);i.resolve(n.id)}).fail(function(e){i.reject(e)});return i.promise()},_del:function(e,r,i){var s=n.Object.extend(e),o=[];t.each(r,function(e){var t=new s;t.id=e;o.push(t)});n.Object.destroyAll(o).done(function(e){i.resolve(r)}).fail(function(e){i.reject(e)});return i.promise()}});return i}();e.BaasCMS=e.BaasCMS||{};var s=e.BaasCMS;s.adapters=s.adapters||{};s.adapters.Parse=i})(window,window._,window.Parse)